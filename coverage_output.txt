
[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90m/Users/alrs/Documents/el-diario-de-avisos[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | src/app/about/page.bench.test.tsx[2m > [22m[2mAboutPage Performance[2m > [22m[2mmeasures execution time
[22m[39mExecution time: 100.71795800000007ms

 [32mâœ“[39m src/app/about/page.bench.test.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 104[2mms[22m[39m
 [32mâœ“[39m src/app/page.test.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 104[2mms[22m[39m
 [32mâœ“[39m src/components/music-player.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 71[2mms[22m[39m
 [32mâœ“[39m src/components/chat-interface.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[32m 187[2mms[22m[39m
 [32mâœ“[39m src/components/search-filters.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[32m 233[2mms[22m[39m
 [32mâœ“[39m src/components/navbar-ui.test.tsx [2m([22m[2m30 tests[22m[2m)[22m[33m 370[2mms[22m[39m
[90mstdout[2m | src/actions/actions.test.ts[2m > [22m[2mgetNews Performance[2m > [22m[2mshould run queries in parallel
[22m[39mMax concurrency: 2

 [32mâœ“[39m src/actions/actions.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 104[2mms[22m[39m
 [32mâœ“[39m src/components/pagination.test.tsx [2m([22m[2m14 tests[22m[2m)[22m[32m 92[2mms[22m[39m
 [32mâœ“[39m src/app/como-citar/page.test.tsx [2m([22m[2m21 tests[22m[2m)[22m[32m 66[2mms[22m[39m
 [32mâœ“[39m src/components/footer.test.tsx [2m([22m[2m14 tests[22m[2m)[22m[32m 67[2mms[22m[39m
 [32mâœ“[39m src/components/article-swiper.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 40[2mms[22m[39m
 [32mâœ“[39m src/app/source-awareness.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 36[2mms[22m[39m
 [32mâœ“[39m src/app/about/page.test.tsx [2m([22m[2m15 tests[22m[2m)[22m[32m 29[2mms[22m[39m
 [32mâœ“[39m src/components/article-card.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 38[2mms[22m[39m
 [32mâœ“[39m src/app/article/[id]/page.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[32m 36[2mms[22m[39m
 [32mâœ“[39m src/components/member-card.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 24[2mms[22m[39m
 [32mâœ“[39m src/app/chat/page.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[32m 33[2mms[22m[39m
[90mstdout[2m | src/lib/rtf-content-converter.test.ts[2m > [22m[2mrtf-content-converter[2m > [22m[2mprocessRtfContent[2m > [22m[2mshould handle errors by falling back to raw content
[22m[39mRTF content processing failed, using fallback: Error: Mock Error
    at fromString [90m(/Users/alrs/Documents/el-diario-de-avisos/[39msrc/lib/rtf-content-converter.test.ts:9:16[90m)[39m
[90m    at node:internal/util:509:21[39m
    at new Promise (<anonymous>)
[90m    at fromString (node:internal/util:495:12)[39m
    at Module.processRtfContent [90m(/Users/alrs/Documents/el-diario-de-avisos/[39msrc/lib/rtf-content-converter.ts:54:24[90m)[39m
    at [90m/Users/alrs/Documents/el-diario-de-avisos/[39msrc/lib/rtf-content-converter.test.ts:57:28
    at [90mfile:///Users/alrs/Documents/el-diario-de-avisos/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///Users/alrs/Documents/el-diario-de-avisos/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///Users/alrs/Documents/el-diario-de-avisos/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)

 [32mâœ“[39m src/lib/rtf-content-converter.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 18[2mms[22m[39m
 [32mâœ“[39m src/app/tal-dia-como-hoy/page.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 21[2mms[22m[39m
 [32mâœ“[39m src/app/ensayos/[id]/page.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [32mâœ“[39m src/app/layout.test.tsx [2m([22m[2m15 tests[22m[2m)[22m[32m 28[2mms[22m[39m
 [32mâœ“[39m src/lib/rtf-encoding-handler.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m src/components/hero.test.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 17[2mms[22m[39m
 [32mâœ“[39m src/components/chat-message.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 19[2mms[22m[39m
[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould process chat request with context from vector store
[22m[39mðŸ¤– [Chatbot] Received prompt: Â¿QuÃ© conciertos hubo en 1885?

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould process chat request with context from vector store
[22m[39mðŸ“š [Context] Found 2 relevant articles:
   1. [1] Concierto en el Teatro Municipal (1885-03-15) - El Diario de Avisos
   2. [2] Ã“pera Italiana en Caracas (1886-07-20) - La OpiniÃ³n Nacional

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould handle requests with no similar articles found
[22m[39mðŸ¤– [Chatbot] Received prompt: Random query

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould handle requests with no similar articles found
[22m[39mâš ï¸ [Context] No relevant articles found.

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould extract content from UIMessage parts correctly
[22m[39mðŸ¤– [Chatbot] Received prompt: First part second part

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould extract content from UIMessage parts correctly
[22m[39mâš ï¸ [Context] No relevant articles found.

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould use Groq llama-3.3-70b-versatile model
[22m[39mðŸ¤– [Chatbot] Received prompt: Test

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould use Groq llama-3.3-70b-versatile model
[22m[39mâš ï¸ [Context] No relevant articles found.

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould include article IDs and linking instructions in system prompt
[22m[39mðŸ¤– [Chatbot] Received prompt: Tell me about opera

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould include article IDs and linking instructions in system prompt
[22m[39mðŸ“š [Context] Found 1 relevant articles:
   1. [42] Gran Concierto de Ã“pera (1887-05-10) - El Diario de Avisos

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould fall back to message content if parts are missing
[22m[39mðŸ¤– [Chatbot] Received prompt: Direct content without parts

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould fall back to message content if parts are missing
[22m[39mâš ï¸ [Context] No relevant articles found.

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould handle unexpected errors in POST
[22m[39mðŸ¤– [Chatbot] Received prompt: Error test

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould fall back to empty string if no content or parts found
[22m[39mðŸ¤– [Chatbot] Received prompt: 

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould fall back to empty string if no content or parts found
[22m[39mâš ï¸ [Context] No relevant articles found.

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould handle message with empty parts array
[22m[39mðŸ¤– [Chatbot] Received prompt: 

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould handle message with empty parts array
[22m[39mâš ï¸ [Context] No relevant articles found.

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould handle message with parts but no text part
[22m[39mðŸ¤– [Chatbot] Received prompt: 

[90mstdout[2m | src/app/api/chat/route.test.ts[2m > [22m[2mChat API Route[2m > [22m[2mshould handle message with parts but no text part
[22m[39mâš ï¸ [Context] No relevant articles found.

 [32mâœ“[39m src/app/api/chat/route.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m src/lib/rtf-html-converter.integration.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m src/components/scroll-to-results.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m src/components/news-grid.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m src/lib/ai.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m src/lib/search-highlighter.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m src/lib/title-formatter.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | src/lib/vector-store.test.ts[2m > [22m[2mvector-store[2m > [22m[2mfindSimilarArticles[2m > [22m[2mshould generate embedding only once for both article and essay searches
[22m[39mðŸ” [Search] Hybrid query: "test query"

[90mstdout[2m | src/lib/vector-store.test.ts[2m > [22m[2mvector-store[2m > [22m[2mfindSimilarArticles[2m > [22m[2mshould generate embedding only once for both article and essay searches
[22m[39m   - Vector Articles: 0 | Vector Essays: 0 | Keyword Search: 0

[90mstdout[2m | src/lib/vector-store.test.ts[2m > [22m[2mvector-store[2m > [22m[2mfindSimilarArticles[2m > [22m[2mshould reuse the same embedding for multiple vector searches
[22m[39mðŸ” [Search] Hybrid query: "another query"

[90mstdout[2m | src/lib/vector-store.test.ts[2m > [22m[2mvector-store[2m > [22m[2mfindSimilarArticles[2m > [22m[2mshould reuse the same embedding for multiple vector searches
[22m[39m   - Vector Articles: 0 | Vector Essays: 0 | Keyword Search: 0

[90mstdout[2m | src/lib/vector-store.test.ts[2m > [22m[2mvector-store[2m > [22m[2mfindSimilarArticles[2m > [22m[2mshould process results when data is found in database
[22m[39mðŸ” [Search] Hybrid query: "test query"

[90mstdout[2m | src/lib/vector-store.test.ts[2m > [22m[2mvector-store[2m > [22m[2mfindSimilarArticles[2m > [22m[2mshould process results when data is found in database
[22m[39m   - Vector Articles: 1 | Vector Essays: 1 | Keyword Search: 1

 [32mâœ“[39m src/lib/vector-store.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m src/lib/date-range.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m src/actions/actions-rtf.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m src/actions/actions-metadata.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m src/actions/actions-perf.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m src/actions/actions-news-optimization.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m src/lib/page-extractor.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m src/lib/rtf-html-converter.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m src/actions/actions-perf-columns.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | scripts/ingest.bench.test.ts[2m > [22m[2mingestEntities Performance[2m > [22m[2mshould verify database insert behavior
[22m[39mðŸš€ Starting TestEntity Ingestion...

[90mstdout[2m | scripts/ingest.bench.test.ts[2m > [22m[2mingestEntities Performance[2m > [22m[2mshould verify database insert behavior
[22m[39mðŸ“Š Total testentity without embeddings: 5

[90mstdout[2m | scripts/ingest.bench.test.ts[2m > [22m[2mingestEntities Performance[2m > [22m[2mshould verify database insert behavior
[22m[39mðŸ“¦ Processing 5 testentity in this batch...

[90mstdout[2m | scripts/ingest.bench.test.ts[2m > [22m[2mingestEntities Performance[2m > [22m[2mshould verify database insert behavior
[22m[39mðŸ“¡ Generating embeddings for sub-batch 1/3...

[90mstdout[2m | scripts/ingest.bench.test.ts[2m > [22m[2mingestEntities Performance[2m > [22m[2mshould verify database insert behavior
[22m[39mðŸ“¡ Generating embeddings for sub-batch 2/3...

[90mstdout[2m | scripts/ingest.bench.test.ts[2m > [22m[2mingestEntities Performance[2m > [22m[2mshould verify database insert behavior
[22m[39mðŸ“¡ Generating embeddings for sub-batch 3/3...

[90mstdout[2m | scripts/ingest.bench.test.ts[2m > [22m[2mingestEntities Performance[2m > [22m[2mshould verify database insert behavior
[22m[39mðŸ’¾ Saving embeddings to database...

[90mstdout[2m | scripts/ingest.bench.test.ts[2m > [22m[2mingestEntities Performance[2m > [22m[2mshould verify database insert behavior
[22m[39mâœ¨ Successfully ingested 5 embeddings.
ðŸŽ‰ All testentity now have embeddings!

[90mstdout[2m | scripts/ingest.bench.test.ts[2m > [22m[2mingestEntities Performance[2m > [22m[2mshould verify database insert behavior
[22m[39mBENCHMARK_RESULT: db.insert was called 1 times

 [32mâœ“[39m scripts/ingest.bench.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m src/app/tal-dia-como-hoy.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m src/lib/news-order.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 2[2mms[22m[39m
 [32mâœ“[39m src/actions/actions-essay.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 2[2mms[22m[39m
 [32mâœ“[39m src/components/navbar.test.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 2[2mms[22m[39m
 [32mâœ“[39m src/db/schema.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 2[2mms[22m[39m

[2m Test Files [22m [1m[32m46 passed[39m[22m[90m (46)[39m
[2m      Tests [22m [1m[32m326 passed[39m[22m[90m (326)[39m
[2m   Start at [22m 16:13:49
[2m   Duration [22m 5.75s[2m (transform 1.23s, setup 395ms, import 9.35s, tests 1.88s, environment 17.14s)[22m

[34m % [39m[2mCoverage report from [22m[33mv8[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |   86.07 |    77.02 |   85.29 |   86.89 |                   
 actions           |   66.66 |    42.85 |   65.21 |   69.07 |                   
  actions.ts       |   66.66 |    42.85 |   65.21 |   69.07 | ...06-316,358-359 
 app               |      70 |    63.63 |      70 |   67.85 |                   
  apple-icon.png   |       0 |        0 |       0 |       0 |                   
  favicon.ico      |       0 |        0 |       0 |       0 |                   
  globals.css      |       0 |        0 |       0 |       0 |                   
  icon.png         |       0 |        0 |       0 |       0 |                   
  layout.tsx       |     100 |      100 |     100 |     100 |                   
  ...aph-image.tsx |       0 |      100 |       0 |       0 | 5-18              
  page.tsx         |   83.33 |    63.63 |   33.33 |   83.33 | 21-22             
 app/about         |     100 |      100 |     100 |     100 |                   
  page.tsx         |     100 |      100 |     100 |     100 |                   
 app/api/chat      |     100 |    73.07 |     100 |     100 |                   
  route.ts         |     100 |    73.07 |     100 |     100 | 31-32,42-46       
 app/article/[id]  |   58.33 |       70 |   66.66 |   56.52 |                   
  ...aph-image.tsx |       0 |        0 |       0 |       0 | 6-40              
  page.tsx         |     100 |     87.5 |     100 |     100 | 16,21,82          
 app/chat          |     100 |      100 |     100 |     100 |                   
  page.tsx         |     100 |      100 |     100 |     100 |                   
 app/como-citar    |     100 |      100 |     100 |     100 |                   
  page.tsx         |     100 |      100 |     100 |     100 |                   
 app/ensayos/[id]  |     100 |      100 |     100 |     100 |                   
  page.tsx         |     100 |      100 |     100 |     100 |                   
 ...l-dia-como-hoy |     100 |      100 |     100 |     100 |                   
  page.tsx         |     100 |      100 |     100 |     100 |                   
 components        |   90.96 |    87.16 |   90.67 |      92 |                   
  article-card.tsx |     100 |      100 |     100 |     100 |                   
  ...le-swiper.tsx |     100 |    69.23 |     100 |     100 | 63,81             
  ...interface.tsx |   96.87 |    86.36 |     100 |     100 | 39-50,99          
  chat-message.tsx |   83.33 |      100 |      80 |   83.33 | 34                
  chat-widget.tsx  |       0 |        0 |       0 |       0 | 9-25              
  footer.tsx       |     100 |      100 |     100 |     100 |                   
  hero.tsx         |     100 |      100 |     100 |     100 |                   
  member-card.tsx  |     100 |    94.59 |     100 |     100 | 37,87             
  music-player.tsx |   77.61 |    66.66 |    62.5 |   79.03 | ...10-111,119-121 
  navbar-ui.tsx    |     100 |    97.36 |     100 |     100 | 53                
  navbar.tsx       |     100 |      100 |     100 |     100 |                   
  news-grid.tsx    |     100 |      100 |     100 |     100 |                   
  pagination.tsx   |     100 |      100 |     100 |     100 |                   
  ...o-results.tsx |     100 |      100 |     100 |     100 |                   
  ...h-filters.tsx |   92.66 |    89.61 |   94.73 |   93.13 | ...21,357,442-443 
 db                |   49.01 |        0 |   15.38 |   53.19 |                   
  schema.ts        |   49.01 |        0 |   15.38 |   53.19 | ...44,261,272,280 
 lib               |   95.43 |    85.29 |   98.07 |   95.21 |                   
  ai.ts            |   92.85 |       50 |     100 |    92.3 | 7                 
  date-range.ts    |    92.3 |    81.81 |     100 |    92.3 | 17                
  news-order.ts    |      90 |       80 |     100 |   88.88 | 10                
  ...-extractor.ts |   97.05 |      100 |     100 |   96.87 | 34                
  ...-converter.ts |   95.65 |       80 |   83.33 |   95.45 | 56                
  ...ng-handler.ts |     100 |      100 |     100 |     100 |                   
  ...-converter.ts |      92 |    83.33 |     100 |   91.66 | 25-26             
  ...ighlighter.ts |   95.65 |    88.46 |     100 |   95.65 | 122-123           
  ...-formatter.ts |     100 |      100 |     100 |     100 |                   
  vector-store.ts  |   96.15 |    73.91 |     100 |   95.74 | 157-158           
-------------------|---------|----------|---------|---------|-------------------
ERROR: Coverage for branches (77.02%) does not meet global threshold (80%)
